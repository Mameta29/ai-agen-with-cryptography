version: '3.8'

services:
  # ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
  ai-gmail-automation:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=development
      - USE_LOCAL_AI=true
      - LOCAL_AI_URL=http://localhost:11434
      - FALLBACK_TO_OPENAI=false
    volumes:
      - .:/app
      - /app/node_modules
    depends_on:
      - ollama
    command: >
      sh -c "
        echo 'ğŸš€ Actually Intelligent ãƒ‡ãƒ¢ç’°å¢ƒã‚’èµ·å‹•ä¸­...' &&
        pnpm install &&
        echo 'âœ… ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å®Œäº†' &&
        echo 'ğŸ§  ãƒ­ãƒ¼ã‚«ãƒ«AIã‚·ã‚¹ãƒ†ãƒ æº–å‚™å®Œäº†' &&
        echo 'ğŸ” zkVMã‚·ã‚¹ãƒ†ãƒ æº–å‚™å®Œäº†' &&
        echo 'ğŸ¯ ãƒãƒƒã‚«ã‚½ãƒ³ãƒ‡ãƒ¢æº–å‚™å®Œäº†ï¼' &&
        echo '' &&
        echo 'ğŸ“‹ åˆ©ç”¨å¯èƒ½ãªã‚³ãƒãƒ³ãƒ‰:' &&
        echo '  - pnpm dev: é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•' &&
        echo '  - node demo-hackathon-ready.js: ãƒãƒƒã‚«ã‚½ãƒ³ãƒ‡ãƒ¢å®Ÿè¡Œ' &&
        echo '  - ./verify.sh: ã‚·ã‚¹ãƒ†ãƒ æ¤œè¨¼' &&
        echo '' &&
        tail -f /dev/null
      "

  # Ollamaï¼ˆãƒ­ãƒ¼ã‚«ãƒ«AIï¼‰
  ollama:
    image: ollama/ollama:latest
    ports:
      - "11434:11434"
    volumes:
      - ollama_data:/root/.ollama
    environment:
      - OLLAMA_HOST=0.0.0.0
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:11434/api/tags"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

volumes:
  ollama_data: 